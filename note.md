# 全体を通して

- 方針は固めすぎない
- 実装しすぎない
- 思い込みをなくす
- 少しずつ改善する
- 何か問題特有のヒューリスティックは必要
- ボトムアップに考える
- 問題の観察を丁寧にする
- 貪欲の質を上げる

# 考察メモ

## 1/28

- スコアは最短距離の増加量（の期待値）

    $
    \displaystyle f_k = \frac{\sum_{i \neq j} (d_k(i, j) - d(i, j))}{N (N-1)}
    $

    - 最短距離の総和と一緒

- 連結でないとでかいペナルティ
    - 連結であることは前提
- 平面グラフの性質を勉強する必要がありそう
    - https://xuzijian629.hatenablog.com/entry/2019/12/14/163726
    - Separator定理?
    - 最短路問題が$O(n \sqrt{\log r})$で解けるらしい
- ドロネー三角形分割

- 全ての頂点対距離を計算するのは$O(N ^ 3)$であり、現実的でない
    - いくつかサンプリングする?
- 連結かどうかの判定は$O(N)$

- 一つの頂点に対して2つ以上封鎖する道路ができると、回り道をする必要が出てくる
    - 嘘っぽい
- 封鎖する道路に対して、効率的な迂回路が存在するときはそこまで影響がない
    - 効率的な通路が複数存在する場合は、スコアに影響しにくい

- 全ての道路は必ず1回封鎖するので、封鎖する道路の組み合わせを最適化する問題

- 全体の最適化が結構難しい
    - 全ての頂点が始点なので、改善しているかどうかの判断が間違っている可能性もある
- ちなみに、辺を切り替えた時のスコアの差分計算は可能か
    - 無理そう

- 平面グラフなので、座標を使う方針が筋が良さそう
    - 封鎖している道路の反対側にある頂点には行きづらくなる
- 始点を一つに定めると、必要な道路は木になる

- まずは、賢い貪欲を考えよう
    - 焼きなましでたくさん時間をかけて解を作る
        - スコアの遷移も記録しておきたい
    - ビジュアライズして、良い解の性質を見つける
    - 小さいケースで考えた方が良さそう
- 賢い貪欲の初期解を作って、最後に焼く方針になりそう
- なぜ直線が良いのか
    - 直線で工事すると、最短路を何個も潰すことが少なくなる
    - 同じ頂点から出ている、角度が近い辺を潰すと良くない
- 最短距離の評価は局所に分割して計算したい
- 他の方針
    - 1点からダイクストラして、不要な辺を数える
    - 最小全域木を作る

### 良さそうな性質

- 辺の角度
- 最短路に使われている回数
- 封鎖する道路同士の近さ
- 道路の長さ

## 1/29

- 頂点対の最短路をいくつか作って、その工事日時を切り替える
    - `create_initial_state3`
    - 微妙
- `create_initial_state4`
    - 辺同士の角度は、スコアにかなり比例する
    - `out/create_initial_state_progress_20min.png`

- 初期解パートの改善
    - 辺同士の角度のスコアの付け方
        - 2乗で評価した方が良さそう
        - `(sim + 0.7) ^ 3`とか
        - 同じ色だけを考慮しているけど、それで良いか
            - 良さそうだけど。。
    - 繋がっている辺同士の長さも考慮できると良さそう
        - 何が良いかはわからないけど
    - 日数が少ない場合が難しい
- 最適化パートの改善
    - 選ぶ日を一様ランダムでなくする
        - 同じ頂点から出ている辺と同じ日が出やすくする
        - 工事が少ない日ほど選ばれる
    - 重要な辺を重点的に探索する
        - 橋とか
    - 最短距離の評価を局所に分割して計算する
    - 評価の高速化
        - 1箇所しか更新してないのに、全て計算し直しているのは勿体無い

- 最短路を丸ごと入れ替える近傍
- 連結じゃなかった時の対策を入れておく必要はある
    - 日にちごとに連結成分を見て、橋になっている辺の色を変える

```
commit: 370f1ef09184f711d8b8b73e254a16e2a7e7f348
create_initial_state
ave: 14,596,936.61
    average_score
5    47401070
8    32119030
11   14540240
14   12413420
17   10043370
20    7022877
23    8576474
26    7853826
29    5771653

create_random_initial_state
ave: 17,897,145.86
    average_score
5        49541238
8        34788380
11       16592265
14       14205811
17       22685105
20        8500801
23        9955359
26        9017549
29        6845742
```

- この道路が使えないなら、この道路も使わなくても良い